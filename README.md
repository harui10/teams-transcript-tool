# Teams トランスクリプト全文コピーツール

Microsoft TeamsのSharePoint上トランスクリプト表示画面から、仮想スクロールに対応して全文をコピーするブックマークレットです。

## 背景

- Teamsのトランスクリプトは主催者以外はダウンロードボタンが表示されない
- 仮想スクロール採用のため、Ctrl+A → Ctrl+C では画面表示部分しかコピーできない
- このツールは自動スクロールしながら全テキストを収集します

## ファイル構成

```
teams-transcript-tool/
├── README.md                         # このファイル
├── diagnose.js                       # DOM構造診断スクリプト
├── diagnose.bookmarklet.txt          # 診断用ブックマークレット
├── transcript-copy.js                # 本番用スクリプト
├── transcript-copy.bookmarklet.txt   # 本番用ブックマークレット
└── build.js                          # ブックマークレット変換スクリプト
```

## セットアップ

### 1. ブックマークレットを生成

```bash
cd teams-transcript-tool
node build.js
```

### 2. ブックマークとして登録

1. Chromeで新しいブックマークを作成（Ctrl+D または ブックマークバーを右クリック →「ページを追加」）
2. 名前を入力（例：「📝 トランスクリプトコピー」）
3. URLに `transcript-copy.bookmarklet.txt` の内容を貼り付け
4. 保存

## 使い方

### ステップ1: 診断（初回のみ推奨）

1. SharePointのトランスクリプト表示画面（`*.sharepoint.com/*/stream.aspx*`）を開く
2. 「🔍 トランスクリプト診断」ブックマークをクリック
3. 右上にパネルが表示され、DOM構造の調査結果が表示される
4. 問題なければ本番版を使用

### ステップ2: 全文コピー

1. SharePointのトランスクリプト表示画面を開く
2. 「📝 トランスクリプトコピー」ブックマークをクリック
3. 右上にパネルが表示される
4. 「▶ 収集開始」ボタンをクリック
5. 自動的にスクロールしながらテキストが収集される
6. 完了したら「📋 コピー」または「💾 ダウンロード」

## 出力形式

```
話者名 MM:SS
発言内容...

話者名 MM:SS
発言内容...
```

## トラブルシューティング

### 「スクロールコンテナが見つかりません」と表示される

- トランスクリプト表示画面（`stream.aspx`を含むURL）で実行してください
- ページが完全に読み込まれてから実行してください

### 一部のテキストが収集されない

スクロール速度を調整するには、`transcript-copy.js` の以下の値を変更してください：

```javascript
const scrollStep = 150; // スクロール量（小さくすると精度が上がる）
const waitTime = 300;   // 待機時間（長くすると精度が上がる）
```

変更後、`node build.js` で再ビルドしてください。

### セレクタが合わない場合

DOM構造が異なる場合は、診断ツールの結果を参考に `transcript-copy.js` の `SELECTORS` オブジェクトを調整してください。

## 技術詳細

### 仮想スクロール対応

- スクロール量を小さく（150px）、待機時間を長め（300ms）に設定
- 収集開始前に一番上までスクロール
- Map を使用して重複排除しつつ順序を保持
- スクロール位置が変わらなくなったら自動停止

### セレクタ戦略

1. 一般的なセレクタ（`[role="listitem"]` など）を複数パターン試行
2. マッチしない場合、時刻パターン（`MM:SS`）を手がかりにヒューリスティック検出

## ライセンス

MIT License
